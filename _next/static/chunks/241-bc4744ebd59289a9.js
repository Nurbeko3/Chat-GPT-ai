"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{4492:function(e,t,n){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o=n(2265),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,l=o.useEffect,i=o.useLayoutEffect,s=o.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=a({inst:{value:n,getSnapshot:t}}),r=o[0].inst,u=o[1];return i(function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})},[e,n,t]),l(function(){return c(r)&&u({inst:r}),e(function(){c(r)&&u({inst:r})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},554:function(e,t,n){e.exports=n(4492)},2314:function(e,t,n){let o;n.d(t,{RJ:function(){return eE}});var r=n(2265),a=n(554);let l=()=>{},i=l(),s=Object,c=e=>e===i,u=e=>"function"==typeof e,d=(e,t)=>({...e,...t}),f=e=>u(e.then),p=new WeakMap,g=0,y=e=>{let t,n;let o=typeof e,r=e&&e.constructor,a=r==Date;if(s(e)!==e||a||r==RegExp)t=a?e.toJSON():"symbol"==o?e.toString():"string"==o?JSON.stringify(e):""+e;else{if(t=p.get(e))return t;if(t=++g+"~",p.set(e,t),r==Array){for(n=0,t="@";n<e.length;n++)t+=y(e[n])+",";p.set(e,t)}if(r==s){t="#";let o=s.keys(e).sort();for(;!c(n=o.pop());)c(e[n])||(t+=n+":"+y(e[n])+",");p.set(e,t)}}return t},m=new WeakMap,h={},_={},v="undefined",w=typeof window!=v,b=typeof document!=v,E=()=>w&&typeof window.requestAnimationFrame!=v,x=(e,t)=>{let n=m.get(e);return[()=>!c(t)&&e.get(t)||h,o=>{if(!c(t)){let r=e.get(t);t in _||(_[t]=r),n[5](t,d(r,o),r||h)}},n[6],()=>!c(t)&&t in _?_[t]:!c(t)&&e.get(t)||h]},I=!0,[C,R]=w&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[l,l],T={initFocus:e=>(b&&document.addEventListener("visibilitychange",e),C("focus",e),()=>{b&&document.removeEventListener("visibilitychange",e),R("focus",e)}),initReconnect:e=>{let t=()=>{I=!0,e()},n=()=>{I=!1};return C("online",t),C("offline",n),()=>{R("online",t),R("offline",n)}}},S=!r.useId,k=!w||"Deno"in window,O=e=>E()?window.requestAnimationFrame(e):setTimeout(e,1),j=k?r.useEffect:r.useLayoutEffect,A="undefined"!=typeof navigator&&navigator.connection,V=!k&&A&&(["slow-2g","2g"].includes(A.effectiveType)||A.saveData),N=e=>{if(u(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?y(e):"",t]},D=0,L=()=>++D;var F={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function M(...e){let[t,n,o,r]=e,a=d({populateCache:!0,throwOnError:!0},"boolean"==typeof r?{revalidate:r}:r||{}),l=a.populateCache,s=a.rollbackOnError,p=a.optimisticData,g=!1!==a.revalidate,y=e=>"function"==typeof s?s(e):!1!==s,h=a.throwOnError;if(u(n)){let e=[];for(let o of t.keys())!/^\$(inf|sub)\$/.test(o)&&n(t.get(o)._k)&&e.push(o);return Promise.all(e.map(_))}return _(n);async function _(n){let r;let[a]=N(n);if(!a)return;let[s,d]=x(t,a),[_,v,w,b]=m.get(t),E=_[a],I=()=>g&&(delete w[a],delete b[a],E&&E[0])?E[0](2).then(()=>s().data):s().data;if(e.length<3)return I();let C=o,R=L();v[a]=[R,0];let T=!c(p),S=s(),k=S.data,O=S._c,j=c(O)?k:O;if(T&&d({data:p=u(p)?p(j,k):p,_c:j}),u(C))try{C=C(j)}catch(e){r=e}if(C&&f(C)){if(C=await C.catch(e=>{r=e}),R!==v[a][0]){if(r)throw r;return C}r&&T&&y(r)&&(l=!0,d({data:C=j,_c:i}))}l&&!r&&(u(l)&&(C=l(C,j)),d({data:C,error:i,_c:i})),v[a][1]=L();let A=await I();if(d({_c:i}),r){if(h)throw r;return}return l?A:C}}let P=(e,t)=>{for(let n in e)e[n][0]&&e[n][0](t)},U=(e,t)=>{if(!m.has(e)){let n=d(T,t),o={},r=M.bind(i,e),a=l,s={},c=(e,t)=>{let n=s[e]||[];return s[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},u=(t,n,o)=>{e.set(t,n);let r=s[t];if(r)for(let e of r)e(n,o)},f=()=>{if(!m.has(e)&&(m.set(e,[o,{},{},{},r,u,c]),!k)){let t=n.initFocus(setTimeout.bind(i,P.bind(i,o,0))),r=n.initReconnect(setTimeout.bind(i,P.bind(i,o,1)));a=()=>{t&&t(),r&&r(),m.delete(e)}}};return f(),[e,r,f,a]}return[e,m.get(e)[4]]},[J,W]=U(new Map),q=d({onLoadingSlow:l,onSuccess:l,onError:l,onErrorRetry:(e,t,n,o,r)=>{let a=n.errorRetryCount,l=r.retryCount,i=~~((Math.random()+.5)*(1<<(l<8?l:8)))*n.errorRetryInterval;(c(a)||!(l>a))&&setTimeout(o,i,r)},onDiscarded:l,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:V?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:V?5e3:3e3,compare:(e,t)=>y(e)==y(t),isPaused:()=>!1,cache:J,mutate:W,fallback:{}},{isOnline:()=>I,isVisible:()=>{let e=b&&document.visibilityState;return c(e)||"hidden"!==e}}),B=(e,t)=>{let n=d(e,t);if(t){let{use:o,fallback:r}=e,{use:a,fallback:l}=t;o&&a&&(n.use=o.concat(a)),r&&l&&(n.fallback=d(r,l))}return n},$=(0,r.createContext)({}),z=w&&window.__SWR_DEVTOOLS_USE__,G=z?window.__SWR_DEVTOOLS_USE__:[],H=e=>u(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],K=()=>d(q,(0,r.useContext)($)),Q=G.concat(e=>(t,n,o)=>{let r=n&&((...e)=>{let[o]=N(t),[,,,r]=m.get(J),a=r[o];return c(a)?n(...e):(delete r[o],a)});return e(t,r,o)}),X=(e,t,n)=>{let o=t[e]||(t[e]=[]);return o.push(n),()=>{let e=o.indexOf(n);e>=0&&(o[e]=o[o.length-1],o.pop())}};z&&(window.__SWR_DEVTOOLS_REACT__=r);let Y=r.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),Z={dedupe:!0};s.defineProperty(e=>{let{value:t}=e,n=(0,r.useContext)($),o=u(t),a=(0,r.useMemo)(()=>o?t(n):t,[o,n,t]),l=(0,r.useMemo)(()=>o?a:B(n,a),[o,n,a]),s=a&&a.provider,c=(0,r.useRef)(i);s&&!c.current&&(c.current=U(s(l.cache||J),a));let f=c.current;return f&&(l.cache=f[0],l.mutate=f[1]),j(()=>{if(f)return f[2]&&f[2](),f[3]},[]),(0,r.createElement)($.Provider,d(e,{value:l}))},"defaultValue",{value:q});let ee=(o=(e,t,n)=>{let{cache:o,compare:l,suspense:s,fallbackData:f,revalidateOnMount:p,revalidateIfStale:g,refreshInterval:y,refreshWhenHidden:h,refreshWhenOffline:_,keepPreviousData:v}=n,[w,b,E,I]=m.get(o),[C,R]=N(e),T=(0,r.useRef)(!1),A=(0,r.useRef)(!1),V=(0,r.useRef)(C),D=(0,r.useRef)(t),P=(0,r.useRef)(n),U=()=>P.current,J=()=>U().isVisible()&&U().isOnline(),[W,q,B,$]=x(o,C),z=(0,r.useRef)({}).current,G=c(f)?n.fallback[C]:f,H=(e,t)=>{for(let n in z)if("data"===n){if(!l(e[n],t[n])&&(!c(e[n])||!l(el,t[n])))return!1}else if(t[n]!==e[n])return!1;return!0},K=(0,r.useMemo)(()=>{let e=!!C&&!!t&&(c(p)?!U().isPaused()&&!s&&(!!c(g)||g):p),n=t=>{let n=d(t);return(delete n._k,e)?{isValidating:!0,isLoading:!0,...n}:n},o=W(),r=$(),a=n(o),l=o===r?a:n(r),i=a;return[()=>{let e=n(W());return H(e,i)?(i.data=e.data,i.isLoading=e.isLoading,i.isValidating=e.isValidating,i.error=e.error,i):(i=e,e)},()=>l]},[o,C]),Q=(0,a.useSyncExternalStore)((0,r.useCallback)(e=>B(C,(t,n)=>{H(n,t)||e()}),[o,C]),K[0],K[1]),ee=!T.current,et=w[C]&&w[C].length>0,en=Q.data,eo=c(en)?G:en,er=Q.error,ea=(0,r.useRef)(eo),el=v?c(en)?ea.current:en:eo,ei=(!et||!!c(er))&&(ee&&!c(p)?p:!U().isPaused()&&(s?!c(eo)&&g:c(eo)||g)),es=!!(C&&t&&ee&&ei),ec=c(Q.isValidating)?es:Q.isValidating,eu=c(Q.isLoading)?es:Q.isLoading,ed=(0,r.useCallback)(async e=>{let t,o;let r=D.current;if(!C||!r||A.current||U().isPaused())return!1;let a=!0,s=e||{},d=!E[C]||!s.dedupe,f=()=>S?!A.current&&C===V.current&&T.current:C===V.current,p={isValidating:!1,isLoading:!1},g=()=>{q(p)},y=()=>{let e=E[C];e&&e[1]===o&&delete E[C]},m={isValidating:!0};c(W().data)&&(m.isLoading=!0);try{if(d&&(q(m),n.loadingTimeout&&c(W().data)&&setTimeout(()=>{a&&f()&&U().onLoadingSlow(C,n)},n.loadingTimeout),E[C]=[r(R),L()]),[t,o]=E[C],t=await t,d&&setTimeout(y,n.dedupingInterval),!E[C]||E[C][1]!==o)return d&&f()&&U().onDiscarded(C),!1;p.error=i;let e=b[C];if(!c(e)&&(o<=e[0]||o<=e[1]||0===e[1]))return g(),d&&f()&&U().onDiscarded(C),!1;let s=W().data;p.data=l(s,t)?s:t,d&&f()&&U().onSuccess(t,C,n)}catch(n){y();let e=U(),{shouldRetryOnError:t}=e;!e.isPaused()&&(p.error=n,d&&f()&&(e.onError(n,C,e),(!0===t||u(t)&&t(n))&&J()&&e.onErrorRetry(n,C,e,e=>{let t=w[C];t&&t[0]&&t[0](F.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return a=!1,g(),!0},[C,o]),ef=(0,r.useCallback)((...e)=>M(o,V.current,...e),[]);if(j(()=>{D.current=t,P.current=n,c(en)||(ea.current=en)}),j(()=>{if(!C)return;let e=ed.bind(i,Z),t=0,n=X(C,w,(n,o={})=>{if(n==F.FOCUS_EVENT){let n=Date.now();U().revalidateOnFocus&&n>t&&J()&&(t=n+U().focusThrottleInterval,e())}else if(n==F.RECONNECT_EVENT)U().revalidateOnReconnect&&J()&&e();else if(n==F.MUTATE_EVENT)return ed();else if(n==F.ERROR_REVALIDATE_EVENT)return ed(o)});return A.current=!1,V.current=C,T.current=!0,q({_k:R}),ei&&(c(eo)||k?e():O(e)),()=>{A.current=!0,n()}},[C]),j(()=>{let e;function t(){let t=u(y)?y(W().data):y;t&&-1!==e&&(e=setTimeout(n,t))}function n(){!W().error&&(h||U().isVisible())&&(_||U().isOnline())?ed(Z).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[y,h,_,C]),(0,r.useDebugValue)(el),s&&c(eo)&&C){if(!S&&k)throw Error("Fallback data is required when using suspense in SSR.");D.current=t,P.current=n,A.current=!1;let e=I[C];if(c(e)||Y(ef(e)),c(er)){let e=ed(Z);c(el)||(e.status="fulfilled",e.value=!0),Y(e)}else throw er}return{mutate:ef,get data(){return z.data=!0,el},get error(){return z.error=!0,er},get isValidating(){return z.isValidating=!0,ec},get isLoading(){return z.isLoading=!0,eu}}},function(...e){let t=K(),[n,r,a]=H(e),l=B(t,a),i=o,{use:s}=l,c=(s||[]).concat(Q);for(let e=c.length;e--;)i=c[e](i);return i(n,r||l.fetcher||null,l)});var et=((e,t=21)=>(n=t)=>{let o="",r=n;for(;r--;)o+=e[Math.random()*e.length|0];return o})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),en={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},eo={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},er={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},ea={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},el={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},ei={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},es={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ec={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},eu={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},ed={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},ef={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId", "toolName", "args", and "result" property.');return{type:"tool_result",value:e}}},ep={[en.code]:en,[eo.code]:eo,[er.code]:er,[ea.code]:ea,[el.code]:el,[ei.code]:ei,[es.code]:es,[ec.code]:ec,[eu.code]:eu,[ed.code]:ed,[ef.code]:ef};en.name,en.code,eo.name,eo.code,er.name,er.code,ea.name,ea.code,el.name,el.code,ei.name,ei.code,es.name,es.code,ec.name,ec.code,eu.name,eu.code,ed.name,ed.code,ef.name,ef.code;var eg=[en,eo,er,ea,el,ei,es,ec,eu,ed,ef].map(e=>e.code),ey=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let n=e.slice(0,t);if(!eg.includes(n))throw Error("Failed to parse stream string. Invalid code ".concat(n,"."));let o=JSON.parse(e.slice(t+1));return ep[n].parse(o)};async function*em(e){let{isAborted:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new TextDecoder,o=[],r=0;for(;;){let{value:a}=await e.read();if(a&&(o.push(a),r+=a.length,10!==a[a.length-1]))continue;if(0===o.length)break;let l=function(e,t){let n=new Uint8Array(t),o=0;for(let t of e)n.set(t,o),o+=t.length;return e.length=0,n}(o,r);for(let e of(r=0,n.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(ey)))yield e;if(null==t?void 0:t()){e.cancel();break}}}function eh(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function e_(e){let t,{reader:n,abortControllerRef:o,update:r,onToolCall:a,onFinish:l,generateId:i=et,getCurrentDate:s=()=>new Date}=e,c=s(),u={data:[]};for await(let{type:e,value:l}of em(n,{isAborted:()=>(null==o?void 0:o.current)===null})){if("text"===e&&(u.text?u.text={...u.text,content:(u.text.content||"")+l}:u.text={id:i(),role:"assistant",content:l,createdAt:c}),"tool_call"===e){if(null==u.text&&(u.text={id:i(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]),u.text.toolInvocations.push(l),a){let e=await a({toolCall:l});null!=e&&(u.text.toolInvocations[u.text.toolInvocations.length-1]={...l,result:e})}}else if("tool_result"===e){null==u.text&&(u.text={id:i(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]);let e=u.text.toolInvocations.findIndex(e=>e.toolCallId===l.toolCallId);-1!==e?u.text.toolInvocations[e]=l:u.text.toolInvocations.push(l)}let n=null;"function_call"===e&&(u.function_call={id:i(),role:"assistant",content:"",function_call:l.function_call,name:l.function_call.name,createdAt:c},n=u.function_call);let o=null;"tool_calls"===e&&(u.tool_calls={id:i(),role:"assistant",content:"",tool_calls:l.tool_calls,createdAt:c},o=u.tool_calls),"data"===e&&u.data.push(...l);let s=u.text;"message_annotations"===e&&(t?t.push(...l):t=[...l],n=eh(u.function_call,t),o=eh(u.tool_calls,t),s=eh(u.text,t)),(null==t?void 0:t.length)&&["text","function_call","tool_calls"].forEach(e=>{u[e]&&(u[e].annotations=[...t])}),r([n,o,s].filter(Boolean).map(e=>({...eh(e,t)})),[...u.data])}return null==l||l(u),{messages:[u.text,u.function_call,u.tool_calls].filter(Boolean),data:u.data}}async function ev(e){var t;let{api:n,messages:o,body:r,streamMode:a="stream-data",credentials:l,headers:i,abortController:s,restoreMessagesOnFailure:c,onResponse:u,onUpdate:d,onFinish:f,onToolCall:p,generateId:g}=e,y=await fetch(n,{method:"POST",body:JSON.stringify({messages:o,...r}),headers:{"Content-Type":"application/json",...i},signal:null==(t=null==s?void 0:s())?void 0:t.signal,credentials:l}).catch(e=>{throw c(),e});if(u)try{await u(y)}catch(e){throw e}if(!y.ok)throw c(),Error(await y.text()||"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");let m=y.body.getReader();switch(a){case"text":{let e=function(e){let t=new TextDecoder;return function(e){return e?t.decode(e,{stream:!0}):""}}(),t={id:g(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:n,value:o}=await m.read();if(n)break;if(t.content+=e(o),t.id=g(),d([{...t}],[]),(null==s?void 0:s())===null){m.cancel();break}}return null==f||f(t),{messages:[t],data:[]}}case"stream-data":return await e_({reader:m,abortControllerRef:null!=s?{current:s()}:void 0,update:d,onToolCall:p,onFinish(e){f&&null!=e.text&&f(e.text)},generateId:g});default:throw Error("Unknown stream mode: ".concat(a))}}async function ew(e){let{getStreamedResponse:t,experimental_onFunctionCall:n,experimental_onToolCall:o,updateChatRequest:r,getCurrentMessages:a}=e;for(;;){let e=await t();if("messages"in e){let t=!1;for(let l of e.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(t=!0,n){let e=l.function_call;if("object"!=typeof e){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let o=await n(a(),e);if(void 0===o){t=!1;break}r(o)}if(o){let e=l.tool_calls;if(!Array.isArray(e)||e.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let n=await o(a(),e);if(void 0===n){t=!1;break}r(n)}}if(!t)break}else{let t=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===e.function_call||"string"==typeof e.function_call)&&(void 0===e.tool_calls||"string"==typeof e.tool_calls))break;if(n){let o=e.function_call;if("object"!=typeof o){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await n(a(),o);if(void 0===l)break;t(l),r(l)}if(o){let n=e.tool_calls;if("object"!=typeof n){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await o(a(),n);if(void 0===l)break;t(l),r(l)}}}}var eb=async(e,t,n,o,r,a,l,i,s,c,u,d,f,p)=>{var g,y;let m=l.current;n(t.messages,!1);let h=p?t.messages:t.messages.map(e=>{let{role:t,content:n,name:o,toolInvocations:r,function_call:a,tool_calls:l,tool_call_id:i}=e;return{role:t,content:n,...void 0!==o&&{name:o},...void 0!==r&&{toolInvocations:r},tool_call_id:i,...void 0!==a&&{function_call:a},...void 0!==l&&{tool_calls:l}}});if("string"!=typeof e){let o={id:s(),createdAt:new Date,content:"",role:"assistant"};async function _(e){let{content:r,ui:a,next:l}=await e;o.content=r,o.ui=await a,n([...t.messages,{...o}],!1),l&&await _(l)}try{let n=e({messages:h,data:t.data});await _(n)}catch(e){throw n(m,!1),e}return u&&u(o),o}return await ev({api:e,messages:h,body:{data:t.data,...a.current.body,...null==(g=t.options)?void 0:g.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamMode:c,credentials:a.current.credentials,headers:{...a.current.headers,...null==(y=t.options)?void 0:y.headers},abortController:()=>i.current,restoreMessagesOnFailure(){n(m,!1)},onResponse:d,onUpdate(e,a){n([...t.messages,...e],!1),o([...r||[],...a||[]],!1)},onToolCall:f,onFinish:u,generateId:s})};function eE(){let{api:e="/api/chat",id:t,initialMessages:n,initialInput:o="",sendExtraMessageFields:a,experimental_onFunctionCall:l,experimental_onToolCall:i,onToolCall:s,experimental_maxAutomaticRoundtrips:c=0,maxAutomaticRoundtrips:u=c,maxToolRoundtrips:d=u,streamMode:f,onResponse:p,onFinish:g,onError:y,credentials:m,headers:h,body:_,generateId:v=et}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},w=(0,r.useId)(),b=null!=t?t:w,E="string"==typeof e?[e,b]:b,[x]=(0,r.useState)([]),{data:I,mutate:C}=ee([E,"messages"],null,{fallbackData:null!=n?n:x}),{data:R=!1,mutate:T}=ee([E,"loading"],null),{data:S,mutate:k}=ee([E,"streamData"],null),{data:O,mutate:j}=ee([E,"error"],null),A=(0,r.useRef)(I||[]);(0,r.useEffect)(()=>{A.current=I||[]},[I]);let V=(0,r.useRef)(null),N=(0,r.useRef)({credentials:m,headers:h,body:_});(0,r.useEffect)(()=>{N.current={credentials:m,headers:h,body:_}},[m,h,_]);let D=(0,r.useCallback)(async t=>{try{T(!0),j(void 0);let n=new AbortController;V.current=n,await ew({getStreamedResponse:()=>eb(e,t,C,k,S,N,A,V,v,f,g,p,s,a),experimental_onFunctionCall:l,experimental_onToolCall:i,updateChatRequest:e=>{t=e},getCurrentMessages:()=>A.current}),V.current=null}catch(e){if("AbortError"===e.name)return V.current=null,null;y&&e instanceof Error&&y(e),j(e)}finally{T(!1)}let n=A.current,o=n[n.length-1];null!=o&&d>0&&ex(o)&&function(e){let t=0;for(let n=e.length-1;n>=0;n--)if("assistant"===e[n].role)t++;else break;return t}(n)<=d&&await D({messages:n})},[C,T,e,N,p,g,y,j,k,S,f,a,l,i,s,d,A,V,v]),L=(0,r.useCallback)(async function(e){let{options:t,functions:n,function_call:o,tools:r,tool_choice:a,data:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.id||(e.id=v()),D({messages:A.current.concat(e),options:t,data:l,...void 0!==n&&{functions:n},...void 0!==o&&{function_call:o},...void 0!==r&&{tools:r},...void 0!==a&&{tool_choice:a}})},[D,v]),F=(0,r.useCallback)(async function(){let{options:e,functions:t,function_call:n,tools:o,tool_choice:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 0===A.current.length?null:"assistant"===A.current[A.current.length-1].role?D({messages:A.current.slice(0,-1),options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==o&&{tools:o},...void 0!==r&&{tool_choice:r}}):D({messages:A.current,options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==o&&{tools:o},...void 0!==r&&{tool_choice:r}})},[D]),M=(0,r.useCallback)(()=>{V.current&&(V.current.abort(),V.current=null)},[]),P=(0,r.useCallback)(e=>{C(e,!1),A.current=e},[C]),[U,J]=(0,r.useState)(o),W=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;n&&(N.current={...N.current,...n}),e.preventDefault(),U&&(L({content:U,role:"user",createdAt:new Date},t),J(""))},[U,L]),q=e=>{let{toolCallId:t,result:n}=e,o=A.current.map((e,o,r)=>o===r.length-1&&"assistant"===e.role&&e.toolInvocations?{...e,toolInvocations:e.toolInvocations.map(e=>e.toolCallId===t?{...e,result:n}:e)}:e);C(o,!1),ex(o[o.length-1])&&D({messages:o})};return{messages:I||[],error:O,append:L,reload:F,stop:M,setMessages:P,input:U,setInput:J,handleInputChange:e=>{J(e.target.value)},handleSubmit:W,isLoading:R,data:S,addToolResult:q,experimental_addToolResult:q}}function ex(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}}}]);